version: '3.8'

services:
  mock-discord:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: mock-discord-test
    ports:
      - "18080:8080"  # REST API (different port to avoid conflicts)
      - "18081:8081"  # Voice server
    environment:
      - LOG_LEVEL=DEBUG
      - MOCK_GUILD_ID=test-guild-123
      - MOCK_USER_ID=test-user-456
      - MOCK_BOT_ID=bot-user-789
    healthcheck:
      test: ["CMD", "wget", "--no-verbose", "--tries=1", "--spider", "http://localhost:8080/health"]
      interval: 5s
      timeout: 3s
      retries: 5
      start_period: 10s
    networks:
      - test-network

  # Acceptance test runner (placeholder for future implementation)
  # acceptance-tests:
  #   build:
  #     context: ../../..
  #     dockerfile: tests/acceptance/Dockerfile
  #   container_name: acceptance-test-runner
  #   depends_on:
  #     mock-discord:
  #       condition: service_healthy
  #   environment:
  #     - MOCK_DISCORD_API_URL=http://mock-discord:8080/api/v10
  #     - MOCK_DISCORD_GATEWAY_URL=ws://mock-discord:8080/gateway
  #     - MOCK_DISCORD_VOICE_URL=mock-discord:8081
  #     - TEST_TIMEOUT=300s
  #     - TEST_PARALLEL=4
  #   volumes:
  #     - ../results:/app/test-results
  #     - ../audio-samples:/app/audio-samples
  #   networks:
  #     - test-network
  #   profiles:
  #     - testing
  #   command: ["go", "test", "./tests/acceptance/...", "-v", "-timeout=300s"]

networks:
  test-network:
    driver: bridge
    name: acceptance-test-network

volumes:
  test-results:
    name: acceptance-test-results
  audio-samples:
    name: acceptance-audio-samples