name: Dependency Update

on:
  schedule:
    # Run weekly on Sundays at 2 AM UTC
    - cron: '0 2 * * 0'
  workflow_dispatch: # Allow manual trigger

jobs:
  update-dependencies:
    runs-on: ubuntu-latest
    
    steps:
    - uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Setup Go Environment
      uses: ./.github/actions/setup-go-env
    
    - name: Update Go modules
      run: |
        go get -u ./...
        go mod tidy
    
    - name: Create Pull Request
      uses: peter-evans/create-pull-request@v7
      with:
        token: ${{ secrets.GITHUB_TOKEN }}
        commit-message: 'chore: update Go dependencies'
        title: 'chore: update Go dependencies'
        body: |
          ## Dependency Update
          
          This PR updates Go dependencies to their latest versions.
          
          ### Changes
          - Updated all Go modules to latest compatible versions
          - Ran `go mod tidy` to clean up dependencies
          - Will be validated by the Build workflow when PR is created
          
          ### Testing
          - ðŸ”„ Build workflow will run automatically to validate changes
          - âœ… Dependencies updated and tidied
          - âœ… Ready for automated testing via PR checks
          
          This is an automated PR created by the dependency update workflow.
          The Build workflow will automatically run to validate all changes.
        branch: chore/update-dependencies
        delete-branch: true

  # The build workflow will automatically run when the PR is created
  # This ensures proper validation using the same pipeline as regular PRs